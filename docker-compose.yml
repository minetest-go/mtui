version: "3.6"

services:
 minetest:
  image: registry.gitlab.com/minetest/minetest/server:5.5.0
  user: root
  volumes:
    - "minetest_home:/root/.minetest"
    - "./dev/worldmods:/root/.minetest/worlds/world/worldmods"
    - "./minetest.conf:/etc/minetest/minetest.conf"
  ports:
    - "30000:30000/udp"

 ui_webapp:
  image: node:18.4.0-alpine3.15
  volumes:
   - "./:/app"
  working_dir: /app/public
  command: ["npm", "ci"]

 ui:
  image: golang:1.18.4
  environment:
   WORLD_DIR: "/root/.minetest/worlds/world"
   WEBDEV: "true"
   JWTKEY: "mysecretjwtkey"
   APIKEY: "mykey"
   COOKIE_DOMAIN: "127.0.0.1"
   COOKIE_SECURE: "true"
   COOKIE_PATH: "/"
  ports:
    - 8080:8080
  volumes:
   - "minetest_home:/root/.minetest"
   - "./dev/worldmods:/root/.minetest/worlds/world/worldmods"
   - "./minetest.conf:/etc/minetest/minetest.conf"
   - "./:/app"
   - "go_cache:/root/.cache"
   - "go_dir:/root/go"
  working_dir: /app
  command: ["go", "run", "."]
  

volumes:
  minetest_home: {}
  go_cache: {}
  go_dir: {}